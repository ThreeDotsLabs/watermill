{{ define "main" }}
<section class="section container-fluid mt-n3 pb-3">
  <div class="row justify-content-center">
    <div class="text-center mb-4">
      <img src="/img/gopher.svg" alt="Logo" style="width: 220px" />
    </div>
    <div class="col-lg-12 text-center">
      <h1>{{ .Title }}</h1>
    </div>
    <div class="col-lg-9 col-xl-8 text-center">
      <p class="lead">{{ .Params.lead | safeHTML }}</p>
      <a class="btn btn-primary btn-cta rounded-pill btn-lg m-3" href="/learn/" role="button">
        Get Started
      </a>
      <a class="btn btn-outline-primary btn-cta rounded-pill btn-lg my-3" href="https://github.com/ThreeDotsLabs/watermill" role="button">
        See on GitHub
      </a>
      {{ .Content }}
    </div>
  </div>
</section>

<section class="section py-5 homepage-features">
  <div class="container">
    <!-- EventBus Section -->
    <div class="row justify-content-center mb-5 pb-5">
      <div class="col-lg-11 col-xl-10 text-center">
        <h2 class="display-4 fw-bold mb-4">Publish Events</h2>
        <p class="lead text-muted mb-5">Send events across your application with simple, type-safe publishing. EventBus handles routing, serialization, and delivery to all subscribers.</p>
        <div class="code-container">
{{ highlight `event := UserRegistered{
    UserID:       "123",
    Email:        "user@example.com",
    RegisteredAt: time.Now(),
}

err := eventBus.Publish(ctx, event)` "go" "" }}
        </div>
      </div>
    </div>

    <!-- EventProcessor Section -->
    <div class="row justify-content-center mb-5 pb-5">
      <div class="col-lg-11 col-xl-10 text-center">
        <h2 class="display-4 fw-bold mb-4">Handle Events</h2>
        <p class="lead text-muted mb-5">Process events with automatic retries, dead letter queues, and middleware. EventProcessor ensures reliable message handling at scale.</p>
        <div class="code-container">
{{ highlight `eventProcessor.AddHandlers(
    cqrs.NewEventHandler("SendWelcomeEmail", sendWelcomeEmail),
    cqrs.NewEventHandler("CreateProfile", createUserProfile),
)

func sendWelcomeEmail(ctx context.Context, event *UserRegistered) error {
    return emailService.SendWelcome(event.Email)
}` "go" "" }}
        </div>
      </div>
    </div>

    <!-- Router Middleware Section -->
    <div class="row justify-content-center mb-5 pb-5">
      <div class="col-lg-11 col-xl-10 text-center">
        <h2 class="display-4 fw-bold mb-4">As Simple as HTTP</h2>
        <p class="lead text-muted mb-5">Use familiar middleware patterns for cross-cutting concerns like logging, metrics, and retries. Chain middleware just like HTTP handlers.</p>
        <div class="code-container">
{{ highlight `router.AddMiddleware(
    middleware.CorrelationID,
    middleware.Retry{
        MaxRetries: 3,
        InitialInterval: time.Second,
    }.Middleware,
    middleware.Recoverer,
    middleware.Timeout(30 * time.Second),
)` "go" "" }}
        </div>
      </div>
    </div>

    <!-- Pub/Sub Support Section -->
    <div class="row justify-content-center mb-5 pb-5">
      <div class="col-lg-11 col-xl-10 text-center">
        <h2 class="display-4 fw-bold mb-4">Supports your favorite Pub/Sub</h2>
        <p class="lead text-muted mb-5">Connect to Kafka, RabbitMQ, PostgreSQL, Redis, and more with the same API. Switch providers without changing your application code.</p>

        <!-- Pub/Sub Logos Collage -->
        <div class="pubsub-logos-container mb-5">
          <div class="pubsub-logos-grid">
            <a href="/pubsubs/kafka/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/kafka.svg" alt="Apache Kafka" />
              <span>Kafka</span>
            </a>
            <a href="/pubsubs/amqp/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/rabbitmq.svg" alt="RabbitMQ" />
              <span>RabbitMQ</span>
            </a>
            <a href="/pubsubs/sql/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/postgresql.svg" alt="PostgreSQL" />
              <span>PostgreSQL</span>
            </a>
            <a href="/pubsubs/redisstream/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/redis.svg" alt="Redis" />
              <span>Redis</span>
            </a>
            <a href="/pubsubs/nats/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/nats.svg" alt="NATS" />
              <span>NATS</span>
            </a>
            <a href="/pubsubs/aws/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/aws.svg" alt="AWS SQS/SNS" />
              <span>AWS</span>
            </a>
            <a href="/pubsubs/googlecloud/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/gcp.svg" alt="Google Cloud Pub/Sub" />
              <span>Google Cloud</span>
            </a>
            <a href="/pubsubs/http/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/http.svg" alt="HTTP" />
              <span>HTTP</span>
            </a>
            <a href="/pubsubs/firestore/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/firestore.svg" alt="Google Firestore" />
              <span>Firestore</span>
            </a>
            <a href="/pubsubs/sql/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/mysql.svg" alt="MySQL" />
              <span>MySQL</span>
            </a>
            <a href="/pubsubs/sql/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/sqlite.svg" alt="SQLite" />
              <span>SQLite</span>
            </a>
            <a href="/pubsubs/bolt/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/bolt.svg" alt="BoltDB" />
              <span>BoltDB</span>
            </a>
            <a href="/pubsubs/io/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/io.svg" alt="I/O" />
              <span>I/O</span>
            </a>
            <a href="/pubsubs/gochannel/" class="pubsub-logo-item">
              <img src="/img/pubsub-logos/gochannel.svg" alt="Go Channel" />
              <span>GoChannel</span>
            </a>
          </div>
        </div>
      </div>
    </div>


      <!-- Library vs Framework Section -->
      <div class="row justify-content-center mb-5 pb-5">
          <div class="col-lg-11 col-xl-10 text-center">
              <h2 class="display-4 fw-bold mb-4">Library, Not Framework</h2>
              <p class="lead text-muted mb-5">Integrate Watermill into existing applications without architectural changes. Use only the components you need.</p>
              <div class="code-container">
                  {{ highlight `// Add to existing HTTP server
                  func (h *Handler) RegisterUser(w http.ResponseWriter, r *http.Request) {
                  user := createUser(r)

                  // Your existing business logic
                  if err := h.userRepo.Save(user); err != nil {
                  http.Error(w, err.Error(), 500)
                  return
                  }

                  // Optional: Publish event for decoupled features
                  h.eventBus.Publish(r.Context(), &UserRegistered{...})
                  }` "go" "" }}
              </div>
          </div>
      </div>
  </div>
</section>
{{ end }}

{{ define "sidebar-prefooter" }}
  {{ if site.Params.doks.backgroundDots -}}
  <div class="d-flex justify-content-start">
    <div class="bg-dots"></div>
  </div>
  {{ end -}}
{{ end }}

{{ define "sidebar-footer" }}
{{ if site.Params.doks.sectionFooter -}}
<section class="section section-md container-fluid bg-light">
  <div class="row justify-content-center text-center">
    <div class="col-lg-7">
      <h2 class="mt-2">Start building with Doks today</h2>
      <a class="btn btn-primary rounded-pill px-4 my-2" href="/docs/{{ if site.Params.doks.docsVersioning }}{{ site.Params.doks.docsVersion }}/{{ end }}prologue/introduction/" role="button">{{ i18n "get-started" }}</a>
    </div>
  </div>
</section>
{{ end -}}
{{ end }}
